
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>How to Generate Slugs - I'm Durrell Chamorro</title>
  <meta name="author" content="Durrell Chamorro">

  
  <meta name="description" content="How to Generate Slugs written +
+ +
+
Oct 13th, 2015 8:06 pm in rails Slugs make pretty URLs. Pretty URLs help optimize your app for search engines &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://durrellchamorro.github.io/blog/2015/10/13/how-to-generate-slugs">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="I'm Durrell Chamorro" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  

</head>

  <body>
    <a href="/" class="home-icon">
      <img src="/images/home.png"/>
    </a>

    <article role="article" class="full-single-article">
  <div class="container">
    <div class="row">
      <div class="col-md-8 col-md-offset-2">
        <h1>How to Generate Slugs</h1>
        <div class="meta">
          written +
+

+
+
<time class='entry-date' datetime='2015-10-13T20:06:52-07:00'><span class='date'><span class='date-month'>Oct</span> <span class='date-day'>13</span><span class='date-suffix'>th</span>, <span class='date-year'>2015</span></span> <span class='time'>8:06 pm</span></time>
          

in
<span class="categories">
  
    <a class='category' href='/blog/categories/rails/'>rails</a>
  
</span>


        </div>
        <p>Slugs make pretty URLs. Pretty URLs help optimize your app for search engines and they
hide sensitive database information. In this post, I&rsquo;ll explain, line by line, one approach
to generating slugs. <!--more--></p>

<p>Here is the code I will explain. You can include it in your project as
a gem by putting <code>gem 'sluggable_durrell'</code> in your Gemfile or you can just copy
the code below into a module.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">module</span> <span class="nn">Sluggable</span>
</span><span class='line'>  <span class="kp">extend</span> <span class="no">ActiveSupport</span><span class="o">::</span><span class="no">Concern</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">included</span> <span class="k">do</span>
</span><span class='line'>    <span class="n">before_save</span> <span class="ss">:generate_slug</span>
</span><span class='line'>    <span class="n">class_attribute</span> <span class="ss">:slug_column</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">to_param</span>
</span><span class='line'>    <span class="n">slug</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">generate_slug</span>
</span><span class='line'>    <span class="n">the_slug</span> <span class="o">=</span> <span class="n">to_slug</span><span class="p">(</span><span class="nb">self</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="nb">self</span><span class="o">.</span><span class="n">class</span><span class="o">.</span><span class="n">slug_column</span><span class="p">))</span>
</span><span class='line'>    <span class="n">object</span> <span class="o">=</span> <span class="nb">self</span><span class="o">.</span><span class="n">class</span><span class="o">.</span><span class="n">find_by</span><span class="p">(</span><span class="ss">slug</span><span class="p">:</span> <span class="n">the_slug</span><span class="p">)</span>
</span><span class='line'>    <span class="n">count</span> <span class="o">=</span> <span class="mi">2</span>
</span><span class='line'>    <span class="k">while</span> <span class="n">object</span> <span class="o">&amp;&amp;</span> <span class="n">object</span> <span class="o">!=</span> <span class="nb">self</span>
</span><span class='line'>      <span class="n">the_slug</span> <span class="o">=</span> <span class="n">append_suffix</span><span class="p">(</span><span class="n">the_slug</span><span class="p">,</span> <span class="n">count</span><span class="p">)</span>
</span><span class='line'>      <span class="n">object</span> <span class="o">=</span> <span class="nb">self</span><span class="o">.</span><span class="n">class</span><span class="o">.</span><span class="n">find_by</span><span class="p">(</span><span class="ss">slug</span><span class="p">:</span> <span class="n">the_slug</span><span class="p">)</span>
</span><span class='line'>      <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>    <span class="nb">self</span><span class="o">.</span><span class="n">slug</span> <span class="o">=</span> <span class="n">the_slug</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">append_suffix</span><span class="p">(</span><span class="n">the_slug</span><span class="p">,</span> <span class="n">count</span><span class="p">)</span>
</span><span class='line'>    <span class="k">if</span> <span class="n">the_slug</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">last</span><span class="o">.</span><span class="n">to_i</span> <span class="o">!=</span> <span class="mi">0</span>
</span><span class='line'>      <span class="k">return</span> <span class="n">the_slug</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">slice</span><span class="p">(</span><span class="mi">0</span><span class="o">.</span><span class="n">.</span><span class="o">.</span><span class="n">-</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;-&quot;</span> <span class="o">+</span> <span class="n">count</span><span class="o">.</span><span class="n">to_s</span>
</span><span class='line'>    <span class="k">else</span>
</span><span class='line'>      <span class="k">return</span> <span class="n">the_slug</span> <span class="o">+</span> <span class="s2">&quot;-&quot;</span> <span class="o">+</span> <span class="n">count</span><span class="o">.</span><span class="n">to_s</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">to_slug</span><span class="p">(</span><span class="nb">name</span><span class="p">)</span>
</span><span class='line'>    <span class="nb">name</span><span class="o">.</span><span class="n">parameterize</span><span class="o">.</span><span class="n">gsub</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">downcase</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">module</span> <span class="nn">ClassMethods</span>
</span><span class='line'>    <span class="k">def</span> <span class="nf">sluggable_column</span><span class="p">(</span><span class="n">column_name</span><span class="p">)</span>
</span><span class='line'>      <span class="nb">self</span><span class="o">.</span><span class="n">slug_column</span> <span class="o">=</span> <span class="n">column_name</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="kp">extend</span> <span class="no">ActiveSupport</span><span class="o">::</span><span class="no">Concern</span>
</span></code></pre></td></tr></table></div></figure>


<p>To make a long story short, this line lets the methods
in the <code>Sluggable</code> module become instance methods of the class that includes the <code>Sluggable</code> module. It
also looks for a module named <code>ClassMethods</code> and includes the methods inside the <code>ClassMethods</code> module as
class methods of the class that includes the Sluggable module. Click <a href="http://www.fakingfantastic.com/2010/09/20/concerning-yourself-with-active-support-concern/">here</a>
for a more in depth explanation of how <code>ActiveSupport::Concern</code> works.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">included</span> <span class="k">do</span>
</span><span class='line'>  <span class="n">before_save</span> <span class="ss">:generate_slug</span>
</span><span class='line'>  <span class="n">class_attribute</span> <span class="ss">:slug_column</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>This fires the code inside the do block when the module is included in the class.
The <code>before_save</code> method tells the class to call <code>generate_slug</code> on each instance of the class
before the instance is saved. The <code>class_attribute</code> method adds an attribute named <code>slug_column</code> to the
class.</p>

<p>Let&rsquo;s say you have a Categories controller with a <code>show</code> action like this:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">def</span> <span class="nf">show</span>
</span><span class='line'>  <span class="vi">@category</span> <span class="o">=</span> <span class="no">Category</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">params</span><span class="o">[</span><span class="ss">:id</span><span class="o">]</span><span class="p">)</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>Let&rsquo;s say you have a corresponding view, <code>/views/categories/show.html.erb</code> and you have the line: <code>resources :categories</code>
in your <code>routes.rb</code> file which gives you a <code>category_path</code>
helper such that you can link to this show page like so:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='erb'><span class='line'><span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="vi">@category</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">category_path</span><span class="p">(</span><span class="vi">@category</span><span class="p">)</span> <span class="cp">%&gt;</span><span class="x"></span>
</span></code></pre></td></tr></table></div></figure>


<p>or if you prefer the shorter way:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='erb'><span class='line'><span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="vi">@category</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="vi">@category</span> <span class="cp">%&gt;</span><span class="x"></span>
</span></code></pre></td></tr></table></div></figure>


<p>If you hover over the link with your mouse in Chrome, you will see the URL
that link points to in the bottom left hand corner of your browser. In this case
the development URL might look something like this:
<code>http://localhost:3000/categories/1</code>. This is what we would expect since if you go to
<code>http://localhost:3000/rails/info/routes</code> you will see the path for the <code>category_path</code> helper
is <code>/categories/:id(.:format)</code>.</p>

<p>The 1 at the end of the URL in the example above is is the <code>:id</code> or in other words the
primary key for that particular category. How does the link know to point to the correct <code>:id</code> if
all it is given is the <code>@category</code> object? The trick is behind the scenes rails calls <code>to_param</code> on
<code>@category</code> and <code>to_param</code> returns the primary key in a string as shown below in the rails console.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">category</span> <span class="o">=</span> Category.first
</span><span class='line'>category.to_param
</span><span class='line'> <span class="o">=</span>&gt; <span class="s2">&quot;1&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<p>With that being said I can now explain why the <code>to_param</code> method is overridden in the Sluggable module:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">def</span> <span class="nf">to_param</span>
</span><span class='line'>  <span class="n">slug</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>Instead of returning the primary key of the category, we want to return the slug so the URL
will read like this instead <code>http://localhost:3000/categories/programming</code>. If you put a
<code>binding.pry</code> in the show action like so:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>   19: def <span class="nv">show</span>
</span><span class='line'><span class="o">=</span>&gt; 20:   binding.pry
</span><span class='line'>   21:   @category <span class="o">=</span> Category.find<span class="o">(</span>params<span class="o">[</span>:id<span class="o">])</span>
</span><span class='line'>   22: end
</span><span class='line'>
</span><span class='line'><span class="o">[</span>1<span class="o">]</span> pry<span class="o">(</span><span class="c">#&lt;CategoriesController&gt;)&gt; params</span>
</span><span class='line'><span class="o">=</span>&gt; <span class="o">{</span><span class="s2">&quot;action&quot;</span><span class="o">=</span>&gt;<span class="s2">&quot;show&quot;</span>, <span class="s2">&quot;controller&quot;</span><span class="o">=</span>&gt;<span class="s2">&quot;categories&quot;</span>, <span class="s2">&quot;id&quot;</span><span class="o">=</span>&gt;<span class="s2">&quot;programming&quot;</span><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>you can see that the <code>:id</code> is now equal to the slug value instead of the primary key which is what we&rsquo;d
expect since we overrode the <code>to_param</code> method to return the slug instead of the primary key. In this example,
I already generated the slug for this category which is why it returned &ldquo;programming&rdquo;. Now I can explain how to
generate the slug.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">def</span> <span class="nf">generate_slug</span>
</span><span class='line'>  <span class="n">the_slug</span> <span class="o">=</span> <span class="n">to_slug</span><span class="p">(</span><span class="nb">self</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="nb">self</span><span class="o">.</span><span class="n">class</span><span class="o">.</span><span class="n">slug_column</span><span class="p">))</span>
</span><span class='line'><span class="o">.</span><span class="n">.</span><span class="o">.</span>
</span></code></pre></td></tr></table></div></figure>


<p><code>self.class</code> returns the class of <code>self</code> so in our example <code>self.class.slug_column</code>
is the same as <code>Category.slug_column</code>. The reason we can call <code>slug_column</code> on the Category
class is because as I explained in the beginning, ActiveSupport::Concern looks for a module named ClassMethods
and includes all the methods inside that module as class methods of the class that includes the Sluggable module. In
our example the Category class/model looks something like this:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">Category</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
</span><span class='line'>  <span class="kp">include</span> <span class="no">Sluggable</span>
</span><span class='line'>  <span class="n">sluggable_column</span> <span class="ss">:name</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>As you can see, the <code>name</code> column from the categories table is being sent to the <code>sluggable_column</code> method as a
symbol.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">module</span> <span class="nn">ClassMethods</span>
</span><span class='line'>  <span class="k">def</span> <span class="nf">sluggable_column</span><span class="p">(</span><span class="n">column_name</span><span class="p">)</span>
</span><span class='line'>    <span class="nb">self</span><span class="o">.</span><span class="n">slug_column</span> <span class="o">=</span> <span class="n">column_name</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>The <code>sluggable_column</code> method takes <code>:name</code> and sets the <code>slug_column</code> attribute equal to <code>:name</code>.
Therefore, <code>self.class.slug_column</code> is equal to <code>:name</code> as demonstrated in the rails console:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">category</span> <span class="o">=</span> Category.first
</span><span class='line'>category.class.slug_column
</span><span class='line'><span class="o">=</span>&gt; :name
</span></code></pre></td></tr></table></div></figure>


<p> Now we can read:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">the_slug</span> <span class="o">=</span> <span class="n">to_slug</span><span class="p">(</span><span class="nb">self</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="nb">self</span><span class="o">.</span><span class="n">class</span><span class="o">.</span><span class="n">slug_column</span><span class="p">))</span>
</span></code></pre></td></tr></table></div></figure>


<p>as:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">the_slug</span> <span class="o">=</span> <span class="n">to_slug</span><span class="p">(</span><span class="nb">self</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="ss">:name</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p><code>self.send(:name)</code> is the same as <code>self.name</code> so we can just read this as:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">the</span> <span class="n">slug</span> <span class="o">=</span> <span class="n">to_slug</span><span class="p">(</span><span class="nb">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>Now I can explain what the <code>to_slug</code> method does.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">def</span> <span class="nf">to_slug</span><span class="p">(</span><span class="nb">name</span><span class="p">)</span>
</span><span class='line'>  <span class="nb">name</span><span class="o">.</span><span class="n">parameterize</span><span class="o">.</span><span class="n">gsub</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">downcase</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p><code>self.name</code>returns a string and the <code>parameterize</code> method is being called on that string. The
<code>parameterize</code> method replaces special characters in a string so that it may be used as part of a ‘pretty’ URL.
The <code>parameterize</code> method doesn&rsquo;t replace the underscore character so <code>gsub</code> is called on the string to remove any underscore and then
downcase is called on it to remove all uppercase characters. This way we&rsquo;ll have a string that can be used in a URL.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">def</span> <span class="nf">generate_slug</span>
</span><span class='line'>  <span class="n">the_slug</span> <span class="o">=</span> <span class="n">to_slug</span><span class="p">(</span><span class="nb">self</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="nb">self</span><span class="o">.</span><span class="n">class</span><span class="o">.</span><span class="n">slug_column</span><span class="p">))</span>
</span><span class='line'>  <span class="c1">#in our ongoing example, the line above becomes: the_slug = &quot;programming&quot;</span>
</span><span class='line'>  <span class="c1">#in our ongoing example, the line below becomes:</span>
</span><span class='line'>  <span class="c1">#object = Category.find_by(slug: &quot;programming&quot;)</span>
</span><span class='line'>  <span class="n">object</span> <span class="o">=</span> <span class="nb">self</span><span class="o">.</span><span class="n">class</span><span class="o">.</span><span class="n">find_by</span><span class="p">(</span><span class="ss">slug</span><span class="p">:</span> <span class="n">the_slug</span><span class="p">)</span>
</span><span class='line'><span class="o">.</span><span class="n">.</span><span class="o">.</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>In this case <code>object</code> will equal <code>nil</code> because we haven&rsquo;t saved the new category to the database yet and we are assuming
I didn&rsquo;t already save a category named &ldquo;programming&rdquo;. Since <code>object</code>
is nil, the while loop will be skipped. This line:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="nb">self</span><span class="o">.</span><span class="n">slug</span> <span class="o">=</span> <span class="n">the_slug</span>
</span></code></pre></td></tr></table></div></figure>


<p>sets the slug column equal to &ldquo;programming&rdquo;. Since we called
<code>before_save :generate_slug</code> the slug will be generated in the create action when
<code>@category = Category.new(category_params)</code> is called. Then the slug will be saved to the database with the <code>@category</code> instance
when the create action calls <code>@category.save</code>.</p>

<p>Let&rsquo;s say there is already a &ldquo;programming&rdquo; category and a user creates a category named &ldquo;programming&rdquo; again. We
don&rsquo;t want different pages to have identical URLs. The solution is to append a suffix to
&ldquo;programming&rdquo; and make sure that suffix is never the same. This example might seem contrived, but if you are
generating the slug based on, say, the title of a post instead of the name of a category, then it is realistic to think
more than one user might have thought of the same post title. Another way around this is to validate the uniqueness of the
sluggable column in the model, but appending a suffix like this allows for flexibility in design and adds a layer
of protection against duplicate URLs.</p>

<p>Continuing with our example, since there is already an instance of Category with &ldquo;programming&rdquo; in the slug column, this time <code>object</code> will not be
equal to <code>nil</code> at this point in the method:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">object</span> <span class="o">=</span> <span class="nb">self</span><span class="o">.</span><span class="n">class</span><span class="o">.</span><span class="n">find_by</span><span class="p">(</span><span class="ss">slug</span><span class="p">:</span> <span class="n">the_slug</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>so the first condition of the while loop will be met. The second condition is that <code>object</code> not
be equal to <code>self</code>. That condition is necessary in case <code>self</code> is only being updated. If <code>self</code> is being updated,
<code>object</code> will equal <code>self</code> and we don&rsquo;t want to append anything to the URL. In the case where <code>self</code> is being created <code>object</code>
will instead be equal to the previous instance of Category with &ldquo;programming&rdquo; in the slug column
so both conditions of the while loop will be true. In the line below <code>the_slug</code> is being set to &ldquo;programming-2&rdquo;.
Let&rsquo;s look at how the <code>append_suffix</code> method works.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">the_slug</span> <span class="o">=</span> <span class="n">append_suffix</span><span class="p">(</span><span class="n">the_slug</span><span class="p">,</span> <span class="n">count</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>The first line of the <code>append_suffix</code> method is:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">if</span> <span class="n">the_slug</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">last</span><span class="o">.</span><span class="n">to_i</span> <span class="o">!=</span> <span class="mi">0</span>
</span></code></pre></td></tr></table></div></figure>


<p>This is saying, since the <code>parameterize</code> method used inside the <code>to_slug</code> method generates
a string that replaces spaces with dashes, <code>the_slug</code> should either be a one word string,
or it should be a string of any number of words separated by dashes instead of spaces.
Therefore, call split on that string to get an array formatted like this:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">the_slug</span> <span class="o">=</span> <span class="s2">&quot;a-url-safe-string&quot;</span>
</span><span class='line'>the_slug.split<span class="o">(</span><span class="s1">&#39;-&#39;</span><span class="o">)</span>
</span><span class='line'><span class="o">=</span>&gt; <span class="o">[</span><span class="s2">&quot;a&quot;</span>, <span class="s2">&quot;url&quot;</span>, <span class="s2">&quot;safe&quot;</span>, <span class="s2">&quot;string&quot;</span><span class="o">]</span>
</span></code></pre></td></tr></table></div></figure>


<p>then it takes the last element in that array and calls <code>to_i</code> on it. Calling <code>to_i</code> on
a string of letters returns 0, and calling <code>to_i</code> on a string that only contains a Fixnum or a Float
returns the appropriate integer.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">def</span> <span class="nf">append_suffix</span><span class="p">(</span><span class="n">the_slug</span><span class="p">,</span> <span class="n">count</span><span class="p">)</span>
</span><span class='line'>  <span class="k">if</span> <span class="n">the_slug</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">last</span><span class="o">.</span><span class="n">to_i</span> <span class="o">!=</span> <span class="mi">0</span>
</span><span class='line'>    <span class="k">return</span> <span class="n">the_slug</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">slice</span><span class="p">(</span><span class="mi">0</span><span class="o">.</span><span class="n">.</span><span class="o">.</span><span class="n">-</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;-&quot;</span> <span class="o">+</span> <span class="n">count</span><span class="o">.</span><span class="n">to_s</span>
</span><span class='line'>  <span class="k">else</span>
</span><span class='line'>    <span class="k">return</span> <span class="n">the_slug</span> <span class="o">+</span> <span class="s2">&quot;-&quot;</span> <span class="o">+</span> <span class="n">count</span><span class="o">.</span><span class="n">to_s</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>Therefore, this is saying if the last element in the array is a number, then take all the elements
but the last one in that array and put them into a string, separating them with a
dash. Then add a dash to the end of the string and then add the integer <code>count</code> equals to the end
of the string such that if <code>the_slug</code> was <code>"programming-2"</code> it would become <code>"programming-3"</code>
Otherwise, the last element in the array is not a number, so just add a dash to the end of <code>the_slug</code> and
then add the integer <code>count</code> equals to the end of <code>the_slug</code> such that if <code>the_slug</code> was <code>"programming"</code>
it would become <code>"programming-2"</code>.</p>

<p>Now, back to the next line of the while loop inside the <code>generate_slug</code> method:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">object</span> <span class="o">=</span> <span class="nb">self</span><span class="o">.</span><span class="n">class</span><span class="o">.</span><span class="n">find_by</span><span class="p">(</span><span class="ss">slug</span><span class="p">:</span> <span class="n">the_slug</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>This is resetting <code>object</code>. If there is an instance of Category saved in the database
with a slug value equal to <code>the_slug</code> then <code>object</code> will be truthy so the loop will continue.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">def</span> <span class="nf">generate_slug</span>
</span><span class='line'><span class="o">.</span><span class="n">.</span><span class="o">.</span>
</span><span class='line'>  <span class="k">while</span> <span class="n">object</span> <span class="o">&amp;&amp;</span> <span class="n">object</span> <span class="o">!=</span> <span class="nb">self</span>
</span><span class='line'>    <span class="n">the_slug</span> <span class="o">=</span> <span class="n">append_suffix</span><span class="p">(</span><span class="n">the_slug</span><span class="p">,</span> <span class="n">count</span><span class="p">)</span>
</span><span class='line'>    <span class="n">object</span> <span class="o">=</span> <span class="nb">self</span><span class="o">.</span><span class="n">class</span><span class="o">.</span><span class="n">find_by</span><span class="p">(</span><span class="ss">slug</span><span class="p">:</span> <span class="n">the_slug</span><span class="p">)</span>
</span><span class='line'>    <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>  <span class="nb">self</span><span class="o">.</span><span class="n">slug</span> <span class="o">=</span> <span class="n">the_slug</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>The next time around <code>count</code> will be one number greater which means <code>the_slug</code>
will have a different number appended to it which means <code>object</code> will be
set to something different. This loop will continue until <code>object</code> is falsy which means <code>the_slug</code> is
finally a unique string.</p>

<p>Finally, the last line of the <code>generate_slug</code> method sets the slug column of <code>self</code>
to the string <code>the_slug</code> was set to. (<code>self</code> is the object <code>generate_slug</code> is being called on.
The example I&rsquo;ve used throughout this post has been <code>@category.generate_slug</code>)
When <code>@category</code> is saved in the create action, <code>@category.slug</code> will equal something like &ldquo;programming-2&rdquo;.
Now wherever you look up a resource that has been slugified you have to change this format:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="vi">@category</span> <span class="o">=</span> <span class="no">Category</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">params</span><span class="o">[</span><span class="ss">:id</span><span class="o">]</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>to this:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="vi">@category</span> <span class="o">=</span> <span class="no">Category</span><span class="o">.</span><span class="n">find_by</span><span class="p">(</span><span class="ss">slug</span><span class="p">:</span> <span class="n">params</span><span class="o">[</span><span class="ss">:id</span><span class="o">]</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>because <code>find</code> will look for a primary key, but <code>params[:id]</code> returns a slug now
since the <code>to_param</code> method is overridden to return the slug instead of the primary key.</p>


        <hr class="divider-short"/>

        
      </div>
    </div>
  </div>
</article>

<hr class="divider-short"/>

<div class="archive-link">
  <div class="container">
    <div class="row">
      <div class="col-md-8 col-md-offset-2">
        
          <a class="pull-left" href="/blog/2015/10/05/self-referential-associations-in-rails/" title="Previous Post: Self Referential Associations in Rails">&laquo; Previous: Self Referential Associations in Rails</a>
        

        
      </div>
    </div>
  </div>
</div>

    <footer id="footer" class="her-row">
  <div class="container">
    <div class="row">
      <div class="col-md-1">
  <a href="/"><h4>Home</h4></a>
</div>

<div class="col-md-2">
  <div class="social-icon-list">
    
    <a href="https://twitter.com/durrellchamorro"><img src="/images/glyphicons_social_31_twitter.png"/></a>
    

    
    <a href="https://github.com/durrellchamorro"><img src="/images/glyphicons_social_21_github.png"/></a>
    

    

    
    <a href="mailto:durrell.chamorro@gmail.com"><img src="/images/glyphicons_social_39_e-mail.png"/></a>
    
  </div>
</div>

<div class="pull-right">
  <h4>Copyright &copy 2015 Durrell Chamorro. Powered by <a href="http://octopress.org/">Octopress</a>. Designed by <a href="http://AdrianArtiles.com">Adrian Artiles</a>. Photo Credit: <a href="http://www.flickr.com/photos/44124348109@N01/8213082764">Tubular</a> via <a href="http://photopin.com">photopin</a> <a href="https://creativecommons.org/licenses/by/2.0/">(license)</a></h4></div>


    </div>
  </div>
</footer>

    
  </body>
</html>
